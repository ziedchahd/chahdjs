import{n as p,J as ee,b as X,a as c,N as H,u as A,i as x,f as P,I as D,g as z,h as N,A as W,O as V,t as C,s as M,F as T,v as j,c as ce,Y as U,R as S,r as oe,k as se,p as he,j as ue,q as fe}from"./index-00bf0c33.js";import{I as J,a as ge}from"./index-e4583d54.js";const me=C('<span class="cm-table-sort">'),ye=C('<span class="cm-table-resize">'),_e=C('<th><div class="cm-table-cell">'),xe=C('<span class="cm-table-tree-level">'),we=C('<td><div class="cm-table-cell">'),be=C('<span class="cm-table-tree-icon-empty">');function q(e){let t;const n=e.column,r=e.colIndex,l=le();ee(()=>{setTimeout(()=>{o()})});const i=()=>({"cm-table-head-col":e.type==="th","cm-table-cell-fixed-left-last":n.fixedLeftLast&&e.showFixedLeft,"cm-table-cell-fixed-right-first":n.fixedRightFirst&&e.showFixedRight});X(()=>{n.width,n._,o()});const o=()=>{if(n.fixed&&t&&!e.placeholder){if(n.fixed==="left"){t.style.position="static";const a=t.closest(".cm-table");if(a){const b=a.querySelector("thead");let g=0;for(let y=1;y<=r;y++){const $=b.querySelector("th:nth-child("+y+")");$&&(g+=$.getBoundingClientRect().width)}t.style.position="sticky",t.style.left=g+"px",t.style.zIndex=e.type==="th"?3:1,t.classList.add("cm-table-cell-fixed-left"),n.fixedLeftLast&&e.showFixedLeft&&t.classList.add("cm-table-cell-fixed-left-last")}}if(n.fixed==="right"){const a=t.closest(".cm-table");if(a){const b=a.querySelector("thead"),g=b.querySelectorAll("th").length;let y=0;for(let $=r+2;$<=g;$++){const E=b.querySelector("th:nth-child("+$+")");console.log(E),y+=E.getBoundingClientRect().width}t.style.position="sticky",t.style.right=y+"px",t.style.zIndex=e.type==="th"?3:1,t.classList.add("cm-table-cell-fixed-right"),n.fixedRightFirst&&e.showFixedRight&&t.classList.add("cm-table-cell-fixed-right-first")}}}},f=()=>e.data._showChildren?"minus-square":"plus-square",d=a=>{l&&l.onRowChecked(e.data,a)},u=a=>{l&&l.onHeadChecked(a)},s=a=>{l&&l.onSort(n,a)},w=()=>{l&&l.onShowChildren(e.data)},k=()=>{l&&l.onExpand(n,e.data)},R=a=>{l&&l.onDragStart(n,a)},v=()=>{const a=e.column;return e.type==="td"?a.type==="index"?e.index+1:a.type==="checkbox"?c(J,{get disabled(){return e.data._disabled},get checked(){return e.data._checked},onChange:d}):e.data._type==="expandChildren"?e.data.render?e.data.render():null:a.type==="expand"?c(D,{name:"chevron-right",get class(){return`cm-table-expand ${e.data._expand?"cm-table-expand-open":""}`},onClick:k}):a.render&&typeof a.render=="function"?a.render(e.data[a.name],a,e.data):e.data[a.name]:a.type==="checkbox"?c(J,{get checked(){return e.checkedAll},onChange:u}):e.column.title};return c(V,{get children(){return[c(H,{get when(){return e.type==="th"},get children(){const a=_e(),b=a.firstChild;return A(g=>{t=g,e.ref&&e.ref(g)},a),x(b,v,null),x(b,c(P,{get when(){return n.sort},get children(){const g=me();return x(g,c(D,{name:"chevron-up",get class(){return n.sortType==="asc"?"cm-table-sort-active":""},get onClick(){return s.bind(null,"asc")}}),null),x(g,c(D,{name:"chevron-down",get class(){return n.sortType==="desc"?"cm-table-sort-active":""},get onClick(){return s.bind(null,"desc")}}),null),g}}),null),x(b,c(P,{get when(){return n.resize&&n.width&&l&&l.border},get children(){const g=ye();return g.$$mousedown=R,g}}),null),z(g=>{const y=i(),$=e.colIndex;return g._v$=N(a,y,g._v$),$!==g._v$2&&W(a,"data-index",g._v$2=$),g},{_v$:void 0,_v$2:void 0}),a}}),c(H,{get when(){return e.type==="td"},get children(){const a=we(),b=a.firstChild,g=t;return typeof g=="function"?A(g,a):t=a,x(b,c(P,{get when(){return n.tree},get children(){return[(()=>{const y=xe();return z(()=>`${e.data._level*16}px`!=null?y.style.setProperty("padding-left",`${e.data._level*16}px`):y.style.removeProperty("padding-left")),y})(),c(P,{get when(){return e.data.children&&e.data.children.length},get fallback(){return be()},get children(){return c(D,{get name(){return f()},class:"cm-table-tree-icon",onClick:w})}})]}}),null),x(b,v,null),z(y=>{const $=i(),E=e.colSpan,B=e.rowSpan;return y._v$3=N(a,$,y._v$3),E!==y._v$4&&W(a,"colspan",y._v$4=E),B!==y._v$5&&W(a,"rowspan",y._v$5=B),y},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),a}})]}})}p(["mousedown"]);const ve=C('<colgroup class="cm-table-colgroup">'),$e=C('<col class="cm-table-col">');function O(e){return(()=>{const t=ve();return x(t,c(T,{get each(){return e.data.columns},children:(n,r)=>{const l=()=>({width:n.width});return(()=>{const i=$e();return z(o=>M(i,l(),o)),i})()}})),t})()}const Ce=C('<div class="cm-table-header"><table><thead><tr>');function ke(e){let t,n;const r=f=>{const d=f.target,u=d.getAttribute("data-index");if(u){const s=parseInt(u);d&&e.onInitColumnWidth(s,d.getBoundingClientRect().width)}},l=f=>{const d=f.target;if(d.tagName==="THEAD"){const u=d.getBoundingClientRect();e.onResizeHeader(u.width,u.height),n.style.height=u.height+"px"}else setTimeout(()=>{const u=d.getBoundingClientRect(),s=d.closest(".cm-table-body").getBoundingClientRect();u.height>s.height?n.style.overflowY="scroll":n.style.overflowY=""})},i=new ResizeObserver(f=>{f.forEach(d=>r(d))});X(()=>{e.data.columns.length&&setTimeout(()=>{const d=t.querySelectorAll("th"),u=d.length;for(let s=0;s<u;s++)i.unobserve(d[s]),i.observe(d[s])})}),j(()=>{const f=t.querySelectorAll("th"),d=f.length;for(let u=0;u<d;u++)f[u]&&i.unobserve(f[u])}),ee(()=>{const f=new ResizeObserver(s=>{s.forEach(w=>l(w))});f.observe(t);const u=t.closest(".cm-table").querySelector(".cm-table-body-wrap");f.observe(u),j(()=>{f.unobserve(t),f.unobserve(u)})});const o=()=>({position:e.sticky?"sticky":"",top:0,"z-index":2,"min-width":"100%","overflow-x":"hidden"});return X(()=>{n&&(n.scrollLeft=e.data.headerLeft)}),(()=>{const f=Ce(),d=f.firstChild,u=d.firstChild,s=u.firstChild,w=n;typeof w=="function"?A(w,f):n=f,x(d,c(O,{get data(){return e.data}}),u);const k=t;return typeof k=="function"?A(k,u):t=u,x(s,c(T,{get each(){return e.data.columns},children:(R,v)=>c(q,{column:R,type:"th",get showFixedLeft(){return e.data.showFixedLeft},get colIndex(){return v()},get showFixedRight(){return e.data.showFixedRight},get checkedAll(){return e.data.checkedAll},ref:a=>{Promise.resolve().then(()=>{e.onInitColumnWidth(v(),a.getBoundingClientRect().width)})}})})),z(R=>M(f,o(),R)),f})()}const Re=C("<tr>"),Se=C('<tr><td><div class="cm-table-emprty-cell">暂无数据'),Ee=C('<div><table class="cm-table-body-wrap"><thead><tr></tr></thead><tbody>'),Le=C('<table class="cm-table-body-wrap"><thead><tr></tr></thead><tbody>'),ze=C('<div class="cm-table-body">');function G(e){const t=le(),n=()=>{e.data._type!=="expandChildren"&&t&&t.highlight&&t.onSelectRow(e.data)},r=()=>({"cm-table-row":!0,"cm-table-row-ood":e.index%2===0,"cm-table-row-even":e.index%2!==0,"cm-table-row-selected":e.data._highlight}),l=()=>({display:e.data._show?"":"none"});return(()=>{const i=Re(),o=e.ref;return typeof o=="function"?A(o,i):e.ref=i,i.$$click=n,x(i,c(V,{get children(){return[c(H,{get when(){return e.data._type==="expandChildren"},get children(){return c(q,{type:"td",get data(){return e.data},get column(){return e.data.column},get index(){return e.index},get showFixedLeft(){return e.store.showFixedLeft},get showFixedRight(){return e.store.showFixedRight},get colSpan(){return e.store.columns.length}})}}),c(H,{get when(){return e.data._type!=="expandChildren"},get children(){return c(T,{get each(){return e.store.columns},children:(f,d)=>{let[u,s]=[1,1];if(t&&t.spanMethod){const w=t.spanMethod(e.data,f,e.index,d());w&&([u,s]=w)}return c(P,{when:u&&s,fallback:null,get children(){return c(q,{type:"td",get data(){return e.data},column:f,get index(){return e.index},get colIndex(){return d()},get showFixedLeft(){return e.store.showFixedLeft},get showFixedRight(){return e.store.showFixedRight},rowSpan:u,colSpan:s})}})}})}})]}})),z(f=>{const d=r(),u=l();return f._v$=N(i,d,f._v$),f._v$2=M(i,u,f._v$2),f},{_v$:void 0,_v$2:void 0}),i})()}function K(e){return(()=>{const t=Se(),n=t.firstChild;return z(()=>W(n,"colspan",e.store.columns.length)),t})()}function Fe(e){let t;const[n,r]=ce(),l=()=>{const d=e.data.columns;let u=0;return d.forEach(s=>{u+=s._width||0}),u};X(()=>{e.data.data;const d=e.data.headerSize.height;if(e.virtual){const u=e.height??document.documentElement.clientHeight;r(u-d)}else setTimeout(()=>{const s=t.querySelector(".cm-table-body-wrap").getBoundingClientRect().height;if(e.height&&s>e.height-d){const w=e.height-d;r(w)}})});const i=()=>{e.onScroll(t.scrollLeft,t.clientWidth,t.scrollWidth)};let o,f;return(()=>{const d=ze();d.addEventListener("scroll",i);const u=t;return typeof u=="function"?A(u,d):t=d,d.style.setProperty("display","block"),d.style.setProperty("width","100%"),d.style.setProperty("overflow","auto"),d.style.setProperty("position","relative"),x(d,c(V,{get children(){return[c(H,{get when(){return e.virtual},get children(){const s=Ee(),w=s.firstChild,k=w.firstChild,R=k.firstChild,v=k.nextSibling,a=o;typeof a=="function"?A(a,s):o=s,s.style.setProperty("min-width","100%"),s.style.setProperty("will-change","transform"),s.style.setProperty("box-sizing","border-box"),s.style.setProperty("contain","strict"),s.style.setProperty("position","absolute"),s.style.setProperty("top","0"),s.style.setProperty("left","0"),x(w,c(O,{get data(){return e.data}}),k),k.style.setProperty("display","none"),x(R,c(T,{get each(){return e.data.columns},children:(g,y)=>c(q,{column:g,type:"th",placeholder:!0,get colIndex(){return y()},get checkedAll(){return e.data.checkedAll}})}));const b=f;return typeof b=="function"?A(b,v):f=v,x(v,c(ge,{scrollElement:t,contentElement:o,bodyElement:f,get items(){return e.data.data},itemEstimatedSize:30,get maxHeight(){return n()||e.height},children:g=>{const y=g.item;return c(G,{data:y,get index(){return g.index},get store(){return e.data},ref($){const E=g.ref;typeof E=="function"?E($):g.ref=$}})}}),null),x(v,c(P,{get when(){return!e.data.data||!e.data.data.length},get children(){return c(K,{get store(){return e.data}})}}),null),z(()=>l()+"px"!=null?s.style.setProperty("width",l()+"px"):s.style.removeProperty("width")),s}}),c(H,{get when(){return!e.virtual},get children(){const s=Le(),w=s.firstChild,k=w.firstChild,R=w.nextSibling,v=f;return typeof v=="function"?A(v,s):f=s,x(s,c(O,{get data(){return e.data}}),w),w.style.setProperty("display","none"),x(k,c(T,{get each(){return e.data.columns},children:(a,b)=>c(q,{column:a,type:"th",placeholder:!0,get colIndex(){return b()},get checkedAll(){return e.data.checkedAll}})})),x(R,c(T,{get each(){return e.data.data},children:(a,b)=>c(G,{data:a,get index(){return b()},get store(){return e.data}})}),null),x(R,c(P,{get when(){return!e.data.data||!e.data.data.length},get children(){return c(K,{get store(){return e.data}})}}),null),s}})]}})),z(()=>n()+"px"!=null?d.style.setProperty("height",n()+"px"):d.style.removeProperty("height")),d})()}p(["click"]);function Q(e){let t=-1,n=Number.MAX_VALUE;return e&&(e.forEach((r,l)=>{r.id=r.id??U(),r.fixed==="left"&&(t=Math.max(t,l)),r.fixed==="right"&&(n=Math.min(n,l))}),t>-1&&e[t]&&(e[t].fixedLeftLast=!0),n<Number.MAX_VALUE&&e[n]&&(e[n].fixedRightFirst=!0)),{maxFixedLeft:t,minFixedRight:n}}function Ae(e,t,n,r,l,i){(e>=0||t<Number.MAX_VALUE)&&(n("showFixedLeft",r>0),n("showFixedRight",l+r<i))}function Z(e){let t=e??[];return t=[...t],t.forEach((n,r)=>{n.id=n.id??U(),n._originSort=r}),t=Pe(e),t}function Ie(e,t,n){let r=[...t.data];n.sortType===""?r.sort((l,i)=>l._originSort-i._originSort>0?1:-1):n.sortMethod&&typeof n.sortMethod=="function"?r.sort(n.sortMethod):r.sort((l,i)=>{const o=n.name??"";return/^[0-9\.]+$/g.test(l[o])?(n.sortType==="asc"?1:-1)*(l[o]-i[o])>0?1:-1:(n.sortType==="asc"?1:-1)*l[o].localeCompare(i[o])}),e("data",r)}function te(e,t,n,r){e.forEach(l=>{l.id=l.id??U(),l._level=n,l._show=r,t.push(l),l.children&&l.children.length&&te(l.children,t,n+1,!!l._showChildren)})}function Pe(e){let t=[];return te(e,t,0,!0),t}const Y=(e,t)=>{e[t]&&e[t].children&&e[t].children.forEach(n=>{n._show=!1,Y(e,n.id)})},Te=(e,t)=>{const n=e[t];n&&n.children&&n.children.forEach(r=>{r._show=n._showChildren,Y(e,r.id)})};function Xe(e,t){e("data",n=>n.id===t.id,S(n=>n._showChildren=!n._showChildren)),e("data",S(n=>{const r=t.children.map(i=>i.id),l={};n.forEach(i=>{l[i.id]=i}),r.forEach(i=>{l[i]&&(l[i]._show=t._showChildren),t._showChildren?Te(l,i):Y(l,i)})}))}function He(e,t,n,r){e("columns",l=>l.name===n.name,S(l=>{l.sortType===r?l.sortType="":l.sortType=r})),n.sort!=="custom"&&Ie(e,t,n)}function Me(e,t,n){e("data",S(r=>{let l=-1;const i=r.find((o,f)=>{const d=o.id===n.id;return d&&(l=f),d});i._expand?(r.splice(l+1,1),i._expand=!1):(i._expand=!0,r.splice(l+1,0,{_type:"expandChildren",_show:!0,column:t,render:t.render?.bind(null,n)}))}))}const qe=(e,t,n)=>{if(typeof n.button=="number"&&n.button!==0)return!1;e("resizing",!0);const r=n.target.getBoundingClientRect().right,l=n.target.closest(".cm-table-wrap").getBoundingClientRect().left;e("posX",r-l),e("startX",r-l),e("x",n.clientX),e("resizeId",t.id)},Be=(e,t,n)=>{if(e.resizing){const r=n.clientX-e.x;t("x",n.clientX);const l=e.posX+r;t("posX",l)}},De=(e,t)=>{t("resizing",!1),t("columns",r=>r.id===e.resizeId,S(r=>{r.width=r.width?parseFloat(r.width)+(e.posX-e.startX)+"px":void 0}));let n;e.columns.find((r,l)=>{const i=r.id===e.resizeId;return i&&(n=e.columns[l+1]?e.columns[l+1].id:void 0),i}),t("columns",r=>r.id===n,S(r=>{r._=U()})),t("posX",0)},We=C('<div><div class="cm-table-resize-helper"></div><div class="cm-table-loading"></div><div class="cm-table">'),ne=he();function Oe(e){const t=()=>ue(e,"cm-table-wrap",{"cm-table-border":e.border,"cm-table-stripe":e.stripe,"cm-table-small":e.size==="small","cm-table-resizing":i.resizing}),{maxFixedLeft:n,minFixedRight:r}=Q(e.columns);let l=Z(e.data);X(()=>{l=Z(e.data),o("data",l),o("checkedAll",!1)}),X(()=>{Q(e.columns),o("columns",e.columns??[]),o("showFixedLeft",!1),o("showFixedRight",!0)});const[i,o]=oe({columns:[],data:[],showFixedLeft:!1,showFixedRight:!0,checkedAll:!1,resizing:!1,x:0,posX:0,startX:0,resizeId:void 0,headerSize:{with:0,height:48},headerLeft:0}),f=h=>{const _=i.data.find(m=>m._highlight);_&&o("data",m=>m.id===_.id,S(m=>m._highlight=!1)),o("data",m=>m.id===h.id,S(m=>m._highlight=!0)),e.onRowSelect&&e.onRowSelect(h,_)},d=(h,_)=>{o("data",I=>I.id===h.id,S(I=>I._checked=_));let m=!1,F=0,L=0;i.data.forEach(I=>{I._disabled||L++,I._checked&&(F++,m="indeterminate")}),F>=L&&(m=!0),o("checkedAll",m),e.onRowChecked&&e.onRowChecked(h,_)},u=h=>{o("checkedAll",h),o("data",m=>h?!m._disabled&&!m._checked:!m._disabled&&m._checked,S(m=>m._checked=h));const _=i.data.filter(m=>m._checked);e.onCheckedAll&&e.onCheckedAll(_)},s=(h,_)=>{He(o,i,h,_),e.onSort&&e.onSort(h,h.sortType)},w=h=>{Xe(o,h)},k=(h,_)=>{Me(o,h,_)},R=(h,_)=>{qe(o,h,_),document.addEventListener("mousemove",v,!1),document.addEventListener("mouseup",a,!1)},v=h=>{Be(i,o,h)},a=()=>{console.log("end"),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",a),De(i,o)},b=()=>({display:i.resizing?"block":"none",left:i.posX+"px"}),g=()=>i.data.filter(h=>h._checked),y=(h,_)=>{const m=i.data.find(F=>{F.id});d(m,_)},$=(h,_)=>{o("columns",h,"_width",_)},E=(h,_)=>{o("headerSize","width",h),o("headerSize","height",_)},B=(h,_,m)=>{Ae(n,r,o,h,_,m),i.headerLeft!==h&&o("headerLeft",h)};e.ref&&e.ref({clearSelect(){o("data",h=>h._highlight,S(h=>h._highlight=!1))},checkAll(h){u(h)},getAllChecked(){return g()},setChecked:y});const re=()=>({...e.style,"max-height":e.height?`${e.height}px`:""}),ie=()=>!!e.height;return c(ne.Provider,{get value(){return{onSelectRow:f,onRowChecked:d,onHeadChecked:u,onSort:s,onShowChildren:w,onExpand:k,onDragStart:R,highlight:e.highlight,border:e.border,spanMethod:e.spanMethod}},get children(){const h=We(),_=h.firstChild,m=_.nextSibling,F=m.nextSibling;return x(h,c(P,{get when(){return e.loading},fallback:null,get children(){return c(se,{})}}),F),x(F,c(ke,{data:i,get sticky(){return ie()},onInitColumnWidth:$,onResizeHeader:E,get virtual(){return e.virtual}}),null),x(F,c(Fe,{data:i,onScroll:B,get height(){return e.height},get virtual(){return e.virtual}}),null),z(L=>{const I=t(),de=b(),ae=re();return L._v$=N(h,I,L._v$),L._v$2=M(_,de,L._v$2),L._v$3=M(F,ae,L._v$3),L},{_v$:void 0,_v$2:void 0,_v$3:void 0}),h}})}const le=()=>fe(ne);export{Oe as T};
